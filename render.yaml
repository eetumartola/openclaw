services:
  - type: web
    name: openclaw
    runtime: docker
    plan: standard
    healthCheckPath: /health
    dockerCommand: >
      sh -lc 'set -eu;
      mkdir -p "$OPENCLAW_STATE_DIR";
      node -e "
        const fs=require(\"fs\");
        const path=require(\"path\");
        const dir=process.env.OPENCLAW_STATE_DIR;
        const cfg=path.join(dir,\"openclaw.json\");
        if (!fs.existsSync(cfg)) {
          const obj={ gateway:{ controlUi:{ allowedOrigins:[process.env.RENDER_EXTERNAL_URL] } } };
          fs.writeFileSync(cfg, JSON.stringify(obj,null,2));
        }
      ";
  exec node openclaw.mjs gateway --allow-unconfigured --bind lan --port \"$PORT\"'
    envVars:
      - key: SETUP_PASSWORD
        sync: false
      - key: OPENCLAW_STATE_DIR
        value: /data/.openclaw
      - key: OPENCLAW_WORKSPACE_DIR
        value: /data/workspace
      - key: OPENCLAW_GATEWAY_TOKEN
        generateValue: true
    disk:
      name: openclaw-data
      mountPath: /data
      sizeGB: 1
